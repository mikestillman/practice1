# license: for mpfr version 2.4.1: LGPL 2.1 or later and GPL (version number unspecified)
# license: for mpfr version 2.4.2: same
# license:          version 3.0  : GNU Lesser General Public License version 3 or later (LGPL v3+)
#				   so our binary distributions should be distributed under GPL 3

VERSION = 3.0.1

# warning: version 3.1.0 breaks 'check loadPackage "EllipticIntegrals"'!
#VERSION = 3.1.0

RELAX = yes
# URL = http://www.mpfr.org/mpfr-$(VERSION)
URL = http://www.math.uiuc.edu/Macaulay2/Downloads/OtherSourceCode/trunk

ifeq (@CC_THREAD_SUPPORT@,yes)
# compiling mpfr with thread local variables is incompatible with libgc, because
#   some libgc pointers are cached in the variables __gmpfr_cache_const_pi, 
#   __gmpfr_cache_const_log2, __gmpfr_cache_const_euler, __gmpfr_cache_const_catalan
# so for now we comment this out.  (Detect the bug by running the tests in
# the package EllipticIntegrals.)
# CONFIGOPTIONS += --enable-thread-safe
endif

ifeq (@SHARED@,no)
CONFIGOPTIONS += --disable-shared
endif
# PRECONFIGURE = autoreconf -i
include ../Makefile.library

# # These are old routines, long deprecated, missing in mpir 1.3.0
# # but mpfr 2.4.2 still uses them, try removing them with 2.4.3:
# CPPFLAGS += -Dmpz_div_2exp=mpz_tdiv_q_2exp -Dmpz_div_ui=mpz_tdiv_q_ui
# # I don't know what to do about gmp_randinit, which is also undefined.  Just run "make -k check" and ignore the errors.
# # So we need this, too:
# CFLAGS += -Wimplicit -Werror

# the DEBUG flag just makes lots of junk print out:
CPPFLAGS += -UDEBUG

BUILDOPTIONS += CPPFLAGS="$(CPPFLAGS)"
CHECKOPTIONS += CPPFLAGS="$(CPPFLAGS)"

Makefile: @srcdir@/Makefile.in ; cd ../.. && ./config.status libraries/mpfr/Makefile
# Local Variables:
# compile-command: "make -C $M2BUILDDIR/libraries/mpfr "
# End:
